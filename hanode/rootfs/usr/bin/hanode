#!/usr/bin/with-contenv bashio

set -o pipefail

compute_hash() {
    sha256sum package.json package-lock.json | sha256sum | awk '{print $1}'
}

update_dependencies() {
    local current_hash=$(compute_hash)
    local hash_file="npm_dependencies.hash"

    if [[ ! -f $hash_file ]] || [[ $current_hash != $(cat $hash_file) ]]; then
        bashio::log.yellow "Dependencies have changed. Running npm ci."
        echo "$current_hash" > $hash_file
        npm ci
    else
        bashio::log.green "Dependencies are up-to-date. Skipping npm ci."
    fi
}

mkdir -p /share/hanode
cd /share/hanode/

echo "Ciao"

# wefwef()

# # Example: Access Home Assistant API
# API_URL=$(bashio::api.supervisor.info | jq -r '.api_url')
# TOKEN=$(bashio::config 'home_assistant_access_token')

# echo $API_URL

# if [ -z "$TOKEN" ]; then
#     bashio::log.error "No access token provided in the configuration."
#     exit 1
# fi

# # Example API call to get Home Assistant states
# curl -s -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" "$API_URL/states" > /share/hanode/states.json

# bashio::log.info "Fetched Home Assistant states and saved to /share/hanode/states.json"

# ./run.sh
